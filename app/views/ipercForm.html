<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Matriz IPERC PYMES - Perú</title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
  <div class="container">
    <div class="layout">
      <aside class="sidebar" id="sidebar">
        <h3>
          IPERC Guardados
          <button type="button" class="toggle-btn" onclick="toggleSidebar()" id="toggleBtn">‹</button>
        </h3>
        <div class="content">
          <div style="padding: 10px; border-bottom: 1px solid #dee2e6;">
            <button type="button" class="btn" style="width: 100%; background: #6c757d;" onclick="loadIpercList()">Actualizar</button>
          </div>
          <ul id="ipercList"><li style="padding:10px;color:#868e96;text-align:center;">No hay registros</li></ul>
        </div>
      </aside>
      <main>
    <div class="header" style="position: relative;">
      <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">Modo Oscuro</button>
      <h1>MATRIZ DE IDENTIFICACIÓN DE PELIGROS Y EVALUACIÓN DE RIESGOS</h1>
      <p>Según Normativa Peruana - MTPE</p>
    </div>

    <form id="ipercForm" method="POST" action="/iperc">
      <!-- Campo oculto para ipercId (cuando se edita) -->
      <input type="hidden" id="ipercId" name="ipercId" value="">
      
      <!-- Encabezado -->
      <div class="section">
        <h2 class="section-title">Información General</h2>
        <div class="form-grid">
          <div class="form-group">
            <label for="company">Razón Social o Denominación Social</label>
            <input type="text" id="company" name="company" class="form-control" placeholder="Ej: CONSTRUCTORA ABC S.A.C." required>
          </div>
          <div class="form-group">
            <label for="area">Área</label>
            <input type="text" id="area" name="area" class="form-control" placeholder="Ej: Operaciones / Producción / Almacén" required>
          </div>
          <div class="form-group">
            <label for="process">Proceso</label>
            <input type="text" id="process" name="process" class="form-control" placeholder="Ej: Transporte de materiales / Soldadura" required>
          </div>
        </div>
      </div>

      <!-- Matriz de riesgos -->
      <div class="section">
        <h2 class="section-title">Matriz de Evaluación de Riesgos</h2>
        <div class="risk-table-container">
          <table id="ipercTable">
            <thead>
              <tr>
                <th class="col-n">N°</th>
                <th class="col-actividad">ACTIVIDAD</th>
                <th class="col-peligro">PELIGRO</th>
                <th class="col-consecuencia">CONSECUENCIA RIESGO</th>
                <th class="col-medidas-exist">MEDIDAS DE CONTROL EXISTENTES</th>
                <th class="col-prob">PROBABILIDAD (P)</th>
                <th class="col-sev">SEVERIDAD (S)</th>
                <th class="col-mr">Nivel de riesgo = P×S</th>
                <th class="col-medidas-impl">MEDIDAS DE CONTROL A IMPLEMENTAR</th>
                <th class="col-responsable">RESPONSABLE</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="col-n">1</td>
                <td class="col-actividad"><input name="rows[0].activity" class="form-control" placeholder="Ej: Carga de materiales" required></td>
                <td class="col-peligro"><input name="rows[0].hazard" class="form-control" placeholder="Ej: Levantamiento manual de cargas" required></td>
                <td class="col-consecuencia"><textarea name="rows[0].consequence" class="form-control" rows="2" placeholder="Ej: Lesiones musculoesqueléticas" required></textarea></td>
                <td class="col-medidas-exist"><textarea name="rows[0].existingControls" class="form-control" rows="2" placeholder="Ej: Capacitación en ergonomía"></textarea></td>
                <td class="col-prob"><input type="number" min="1" max="5" name="rows[0].probability" class="form-control" placeholder="1-5" required></td>
                <td class="col-sev"><input type="number" min="1" max="50" name="rows[0].severity" class="form-control" placeholder="1-50" required></td>
                <td class="col-mr"><span id="mr-0">—</span></td>
                <td class="col-medidas-impl"><textarea name="rows[0].newControls" class="form-control" rows="2" placeholder="Ej: Uso de fajas lumbares"></textarea></td>
                <td class="col-responsable"><input name="rows[0].responsible" class="form-control" placeholder="Ej: Juan Pérez" required></td>
                <td><button type="button" onclick="removeRow(this)" class="btn-action btn-delete">Eliminar</button></td>
              </tr>
            </tbody>
          </table>
        </div>
        <button type="button" class="btn btn-add" onclick="addRow()">+ Añadir fila</button>
      </div>

      <!-- Guía de valoración -->
      <div class="section">
        <h2 class="section-title">Guía de Valoración de Riesgos</h2>
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px;">
          <div class="guide-table">
            <h3>Severidad vs Probabilidad</h3>
            <table>
              <thead>
                <tr>
                  <th rowspan="2">SEVERIDAD</th>
                  <th colspan="5">PROBABILIDAD</th>
                </tr>
                <tr>
                  <th>Escasa (1)</th>
                  <th>Baja (2)</th>
                  <th>Puede suceder (3)</th>
                  <th>Probable (4)</th>
                  <th>Muy probable (5)</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Catastróficos (50)</td>
                  <td class="rojo">50</td>
                  <td class="rojo">100</td>
                  <td class="rojo">150</td>
                  <td class="rojo">200</td>
                  <td class="rojo">250</td>
                </tr>
                <tr>
                  <td>Mayor (20)</td>
                  <td class="naranja">20</td>
                  <td class="naranja">40</td>
                  <td class="naranja">60</td>
                  <td class="naranja">80</td>
                  <td class="naranja">100</td>
                </tr>
                <tr>
                  <td>Moderado alto (10)</td>
                  <td class="amarillo">10</td>
                  <td class="amarillo">20</td>
                  <td class="amarillo">30</td>
                  <td class="amarillo">40</td>
                  <td class="amarillo">50</td>
                </tr>
                <tr>
                  <td>Moderado (5)</td>
                  <td class="amarillo">5</td>
                  <td class="amarillo">10</td>
                  <td class="amarillo">15</td>
                  <td class="amarillo">20</td>
                  <td class="amarillo">25</td>
                </tr>
                <tr>
                  <td>Moderado Leve (2)</td>
                  <td class="verde">2</td>
                  <td class="verde">4</td>
                  <td class="verde">6</td>
                  <td class="verde">8</td>
                  <td class="verde">10</td>
                </tr>
                <tr>
                  <td>Mínima (1)</td>
                  <td class="verde">1</td>
                  <td class="verde">2</td>
                  <td class="verde">3</td>
                  <td class="verde">4</td>
                  <td class="verde">5</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="guide-table">
            <h3>Valoración de Riesgos</h3>
            <table>
              <thead>
                <tr>
                  <th>RIESGO</th>
                  <th>COLOR</th>
                  <th>RANGO</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>CRÍTICO</td>
                  <td class="rojo">ROJO</td>
                  <td>50 < X ≤ 250</td>
                </tr>
                <tr>
                  <td>ALTO</td>
                  <td class="naranja">NARANJA</td>
                  <td>10 < X ≤ 50</td>
                </tr>
                <tr>
                  <td>MEDIO</td>
                  <td class="amarillo">AMARILLO</td>
                  <td>3 < X ≤ 10</td>
                </tr>
                <tr>
                  <td>BAJO</td>
                  <td class="verde">VERDE</td>
                  <td>X ≤ 3</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div style="display: flex; gap: 12px; justify-content: center; margin: 30px 0;">
        <button type="button" class="btn btn-submit" onclick="newMatriz()" style="background: #6c757d;">Nueva Matriz</button>
        <button type="button" class="btn btn-submit" onclick="submitForm('save')" style="background: #28a745;">Guardar</button>
        <button type="button" class="btn btn-submit" onclick="submitForm('export')" style="background: #495057;">Exportar PDF</button>
      </div>
    </form>

    <div class="footer">
      <p>IPERC para Pymes - Proyecto Final Cloud Computing & DevOps</p>
    </div>
      </main>
    </div>
  </div>

  <script src="/js/app.js"></script>
</body>
</html>
